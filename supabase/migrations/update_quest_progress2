
BEGIN
    -- Handle different quest types
    IF task_type_param = 'game_variety' THEN
        -- For game variety, we need to track unique games played
        UPDATE user_daily_quests
        SET progress = LEAST(progress + progress_value, target_value),
            completed = (progress + progress_value >= target_value)
        FROM quests
        WHERE user_daily_quests.quest_id = quests.id
            AND user_daily_quests.user_id = target_user_id
            AND quests.task_type = task_type_param
            AND user_daily_quests.assigned_date = CURRENT_DATE
            AND NOT user_daily_quests.completed;
    
    ELSIF task_type_param = 'big_win' THEN
        -- For big win, update only if the win is significant enough
        UPDATE user_daily_quests
        SET progress = GREATEST(progress, progress_value),
            completed = (progress_value >= target_value)
        FROM quests
        WHERE user_daily_quests.quest_id = quests.id
            AND user_daily_quests.user_id = target_user_id
            AND quests.task_type = task_type_param
            AND user_daily_quests.assigned_date = CURRENT_DATE
            AND NOT user_daily_quests.completed;
    
    ELSE
        -- Default behavior for other quest types
        UPDATE user_daily_quests
        SET progress = LEAST(progress + progress_value, target_value),
            completed = (progress + progress_value >= target_value)
        FROM quests
        WHERE user_daily_quests.quest_id = quests.id
            AND user_daily_quests.user_id = target_user_id
            AND quests.task_type = task_type_param
            AND user_daily_quests.assigned_date = CURRENT_DATE
            AND NOT user_daily_quests.completed;
    END IF;
END;
